# 予約機能設計書

## 概要

予約機能は3つのタイプを提供します：駐車スペース取り置き、時間帯予約、1日予約。各予約方法は異なるユーザーシナリオに対応しています。

## 1. 取り置き機能

### 1.1 機能説明ページ

#### ページ内容
- **タイトル**：「取り置きとは？」
- **機能イラスト**：
  - 「WAITING...」ステータスアニメーション
  - 予約スペースを示す点線枠
  - 充電ステーションアイコン
- **テキスト説明**：
  - 「最大60分間、空いている車室を取り置きできます。」
  - 「「今すぐあそこに行きたい！」という時に、確実に車室を確保いただけます。」
- **料金リマインダー**：
  - 「※取り置きのキャンセルには、キャンセル料金が発生します。」
- **アクションオプション**：
  - チェックボックス：「次回から表示しない」
  - 「OK」確認ボタン

### APIインターフェース

#### 取り置き予約の作成
```
POST /api/v1/reservations/hold
```
**リクエスト:**
```json
{
  "station_id": 1,
  "user_id": "user123",
  "duration_minutes": 60
}
```
**レスポンス:**
```json
{
  "success": true,
  "hold_id": "hold_abc123",
  "station": {
    "id": 1,
    "name": "きたやま関電施設",
    "address": "東京都品川区北品川5-3-1"
  },
  "hold_start": "2024-02-15T19:15:00Z",
  "hold_end": "2024-02-15T20:15:00Z",
  "cancellation_fee": 200
}
```

### 1.2 取り置き状態ページ

#### ページレイアウト
- **カウントダウン表示**：
  - 大きなオレンジ色のテキスト：「20:15まで取り置き」
  - 残り時間を示すオレンジ色のプログレスバー
- **取り置き状態イラスト**：
  - 「WAITING...」テキスト
  - 予約駐車スペース図
- **アクションボタン**：
  - 「到着しました」白いボタン
  - 「入車時のご案内」ヘルプリンク
- **取り置き情報**：
  - 取り置き状況タイトル
  - 施設画像プレースホルダー
  - 施設名：きたやま関電施設
  - 住所：東京都品川区北品川5-3-1
  - 営業時間：8:00～23:00
  - 取り置き開始時間：19:15
  - 取り置き終了時間：20:15

### APIインターフェース

#### 取り置き状態の取得
```
GET /api/v1/reservations/hold/{hold_id}
```
**レスポンス:**
```json
{
  "hold_id": "hold_abc123",
  "status": "active",
  "remaining_minutes": 27,
  "station": {
    "id": 1,
    "name": "きたやま関電施設",
    "address": "東京都品川区北品川5-3-1",
    "business_hours": "8:00-23:00"
  },
  "hold_start": "2024-02-15T19:15:00Z",
  "hold_end": "2024-02-15T20:15:00Z"
}
```

#### 到着確認
```
POST /api/v1/reservations/hold/{hold_id}/arrive
```
**リクエスト:**
```json
{
  "hold_id": "hold_abc123",
  "arrival_time": "2024-02-15T19:45:00Z"
}
```
**レスポンス:**
```json
{
  "success": true,
  "hold_id": "hold_abc123",
  "charging_session_id": "chrg_xyz789",
  "next_step": "start_charging"
}
```

### 1.3 入車ガイドダイアログ

#### ダイアログ内容
- **タイトル**：「入車時のご案内」
- **安全リマインダーイラスト**：
  - スマートバリアの位置を表示
  - 車両駐車図
- **テキスト説明**：
  - 「現地では黄色いスマートバリアが立っている車室の前に車を止めてください。」
  - 「また、アプリを操作する際は、車を停めて、周囲の安全を十分に確認してください。」
- **アクションボタン**：「OK」

### 1.4 キャンセル確認ページ

#### ページ内容
- **キャンセルポリシー**：
  - タイトル：「キャンセルポリシー」
  - 詳細なキャンセル料金説明：
    - (1)急速充電器の場合：500円
    - (2)普通充電器の場合：200円
- **キャンセル確認ダイアログ**：
  - 「取り置きをキャンセルしますか？」
  - 「キャンセルの場合、キャンセル料金が発生します。」
  - 「取り置きをキャンセル」オレンジボタン

### APIインターフェース

#### 取り置き予約のキャンセル
```
POST /api/v1/reservations/hold/{hold_id}/cancel
```
**リクエスト:**
```json
{
  "hold_id": "hold_abc123",
  "reason": "user_cancelled"
}
```
**レスポンス:**
```json
{
  "success": true,
  "hold_id": "hold_abc123",
  "cancellation_fee": 200,
  "fee_charged": true,
  "refund_amount": 0
}
```

## 2. 時間帯予約機能

### ページデザイン
- **施設情報**：
  - タイトル：SBPSテスト
  - 充電仕様選択（6kW選択済み）
  - 充電料金表示
- **日付選択**：
  - 月間カレンダービュー（2月）
  - 週間カレンダークイック選択
  - 選択日付ハイライト表示（17日、土曜日）
- **時間選択**：
  - 時間範囲：19:10 ~ 19:40（30分間）
  - 24時間タイムライン
  - ドラッグ可能な時間帯選択
  - 緑色は選択された時間帯を示す
- **アクションボタン**：
  - 「内容確認画面へ」

### インタラクション機能
- 直感的なタイムラインドラッグ選択
- 選択期間のリアルタイム表示
- 日付と時間の連動選択

### APIインターフェース

#### 利用可能な時間帯の取得
```
GET /api/v1/reservations/timeslots/available
```
**クエリパラメータ:**
- `station_id`: 1
- `date`: "2024-02-17"
- `power_option`: "6kW"

**レスポンス:**
```json
{
  "station_id": 1,
  "date": "2024-02-17",
  "available_slots": [
    {
      "start_time": "19:00",
      "end_time": "19:30",
      "available": true
    },
    {
      "start_time": "19:30",
      "end_time": "20:00",
      "available": true
    }
  ]
}
```

#### 時間帯予約の作成
```
POST /api/v1/reservations/timeslot
```
**リクエスト:**
```json
{
  "station_id": 1,
  "date": "2024-02-17",
  "start_time": "19:10",
  "end_time": "19:40",
  "power_option": "6kW",
  "user_id": "user123"
}
```
**レスポンス:**
```json
{
  "success": true,
  "reservation_id": "res_time123",
  "station_id": 1,
  "reservation_details": {
    "date": "2024-02-17",
    "start_time": "19:10",
    "end_time": "19:40",
    "duration_minutes": 30,
    "power": "6kW",
    "estimated_cost": 200
  }
}
```

## 3. 1日予約機能

### 3.1 予約選択ページ

#### ページレイアウト
- **施設情報**（上記と同じ）
- **予約タイプ切り替え**：
  - 「今すぐ」（即時）
  - 「取り置き」（駐車取り置き）
  - 「1日予約」（終日）- 選択済み
- **予約日**：
  - 予約日：2024/2/15
- **充電仕様**：
  - 急速 100kW ¥50/分
  - 最大60分｜ケーブル有
- **アクションオプション**：
  - 「1日予約とは？」ヘルプリンク
  - 「内容確認画面へ」

### APIインターフェース

#### 1日予約の作成
```
POST /api/v1/reservations/all-day
```
**リクエスト:**
```json
{
  "station_id": 1,
  "date": "2024-02-15",
  "power_option": "100kW",
  "user_id": "user123"
}
```
**レスポンス:**
```json
{
  "success": true,
  "reservation_id": "res_day456",
  "station_id": 1,
  "reservation_details": {
    "date": "2024-02-15",
    "type": "all_day",
    "power": "100kW",
    "max_duration_minutes": 60,
    "daily_fee": 5000,
    "cancellation_policy": {
      "same_day_fee": 5000,
      "advance_fee": 1000
    }
  }
}
```

#### 1日予約の利用可能日確認
```
GET /api/v1/reservations/all-day/availability
```
**クエリパラメータ:**
- `station_id`: 1
- `start_date`: "2024-02-15"
- `end_date`: "2024-05-15"

**レスポンス:**
```json
{
  "station_id": 1,
  "available_dates": [
    {
      "date": "2024-02-15",
      "available": true,
      "quick_chargers": 1,
      "standard_chargers": 3
    },
    {
      "date": "2024-02-16",
      "available": false,
      "reason": "fully_booked"
    }
  ]
}
```

### 3.2 1日予約説明ダイアログ

#### ダイアログ内容
- **タイトル**：「1日予約とは？」
- **注意アイコン**：「CAUTION!」
- **機能説明**：
  - 「3ヶ月先まで日付を指定して車室を確保できます。」
  - 「長時間滞在するお出かけ先で、便利です。」
- **料金リマインダー**：
  - 「※1日予約のご利用、当日のキャンセルには料金がかかります。」
- **アクションオプション**：
  - チェックボックス：「次回から表示しない」
  - 「OK」ボタン

## デザイン仕様

### ビジュアル階層
1. 時間情報優先（大きなフォント、目立つ色）
2. アクションボタン次優先（コントラスト色、中サイズ）
3. 詳細情報最後（通常フォント、グレー）

### インタラクション原則
1. 予約前のルール完全説明
2. キャンセルには確認が必要
3. 透明な料金情報表示
4. シンプルで直感的な操作フロー

### ユーザーエクスペリエンス最適化
- 異なるニーズに対応する複数の予約方法
- ビジュアルな時間選択
- 明確な料金とルール説明
- 便利なキャンセルと変更機能

## カラースキーム
- プライマリー：ティール（#00BCD4）
- アクセント：オレンジ（#FF6B35）
- 成功：グリーン（#4CAF50）
- 背景：ライトグレー（#F5F5F5）

## タイポグラフィ
- ヘッダー：20sp 太字
- 本文：16sp 標準
- キャプション：14sp 標準
- 時間表示：24sp 太字