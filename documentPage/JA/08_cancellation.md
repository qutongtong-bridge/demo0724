# キャンセル機能設計書

## 概要

キャンセル機能は、ユーザーに充電スペースの予約をキャンセルする操作を提供し、明確な視覚的フィードバックと操作確認プロセスを含みます。

## ページデザイン

### ビジュアルデザイン
- **背景**：フルスクリーンの白い背景
- **中央コンテンツ**：キャンセル確認情報

### 主要要素

#### 1. タイトルテキスト
- **内容**：「取り置きをキャンセルしました」
- **カラー**：ティール（#00BCD4）
- **フォントサイズ**：20sp
- **位置**：ページ上部

#### 2. ステータスイラスト
- **アイコン要素**：
  - 吹き出し：「CANCEL!」
  - 充電ステーションアイコン
  - キャンセルマーク（X）
  - キャンセル状態を示す点線の円
- **カラースキーム**：
  - ティールの吹き出し
  - グレーの点線
  - 黒い充電ステーション

#### 3. メッセージテキスト
- **内容**：「またのご利用をお待ちしております。」
- **フォントサイズ**：16sp
- **カラー**：ダークグレー（#333333）
- **位置**：イラストの下

#### 4. アクションボタン
- **テキスト**：「トップへ戻る」
- **スタイル**：
  - オレンジ背景（#FF6B35）
  - 白いテキスト
  - 角丸ボタン
  - 幅：画面幅の80%
- **位置**：ページ下部

## インタラクションフロー

### 1. トリガーシナリオ
- ユーザーが能動的に予約をキャンセル
- 予約時間のタイムアウト自動キャンセル
- システムエラーによるキャンセル

### 2. キャンセルプロセス
1. ユーザーが予約詳細ページでキャンセルをクリック
2. キャンセル確認ダイアログが表示
3. ユーザーがキャンセル操作を確認
4. キャンセル成功ページが表示
5. トップへ戻るボタンをクリックしてメインインターフェースに戻る

### APIインターフェース

#### 予約詳細取得
```
GET /api/v1/reservations/{reservation_id}
```
**レスポンス:**
```json
{
  "reservation_id": "res_123456",
  "type": "hold",
  "status": "active",
  "station": {
    "id": 1,
    "name": "きたやま関電施設",
    "address": "東京都品川区北品川5-3-1"
  },
  "start_time": "2024-02-15T19:15:00Z",
  "end_time": "2024-02-15T20:15:00Z",
  "cancellation_policy": {
    "fee": 200,
    "free_cancellation_before": "2024-02-15T19:00:00Z"
  }
}
```

#### 予約キャンセル
```
POST /api/v1/reservations/{reservation_id}/cancel
```
**リクエスト:**
```json
{
  "reservation_id": "res_123456",
  "cancellation_reason": "change_of_plans",
  "confirm": true
}
```
**レスポンス:**
```json
{
  "success": true,
  "reservation_id": "res_123456",
  "status": "cancelled",
  "cancellation_fee": 200,
  "refund_amount": 0,
  "cancelled_at": "2024-02-15T19:30:00Z"
}
```

### 3. アニメーション効果
- ページ進入：フェードイン効果
- イラスト表示：スケールアニメーション
- ボタンクリック：押下効果

## デザイン仕様

### レイアウト仕様
- **コンテンツ垂直中央**揃え
- **要素間隔**：
  - タイトルからイラスト：40dp
  - イラストからメッセージテキスト：32dp
  - メッセージテキストからボタン：48dp
- **マージン**：左右各16dp

### イラスト仕様
- **サイズ**：200dp x 200dp
- **スタイル**：フラットデザイン
- **カラー**：ブランドカラーと一致

### コピーガイドライン
- **トーン**：フレンドリー、ポジティブ
- **言葉遣い**：簡潔で明確
- **感情**：ネガティブな感情を軽減

## ユーザーエクスペリエンスの考慮事項

### 1. 感情的デザイン
- フレンドリーなイラストでキャンセルによるネガティブな感情を軽減
- ポジティブなコピーで将来の使用を促進
- 明るい色で重い感じを避ける

### 2. 操作ガイダンス
- 明確な戻りパス
- 混乱を避ける単一の操作オプション
- 目立つボタンデザイン

### 3. 情報伝達
- キャンセル成功の明確な通知
- フレンドリーなお別れメッセージ
- メインフローへの素早い復帰

## 拡張機能の提案

### 1. キャンセル理由の収集
- オプションのキャンセル理由選択
- サービス改善に役立つ

### 2. 他の時間帯の推奨
- 近くの利用可能な充電ステーションを表示
- 他の予約時間帯を推奨

### 3. 補償特典
- 次回使用のための割引クーポンを提供
- ポイント補償メカニズム

## 技術実装

### 状態管理
- キャンセル保留中
- キャンセル成功
- キャンセル失敗
- エラーハンドリング

### 分析
- キャンセル理由の追跡
- キャンセル率の監視
- ユーザー行動パターン

### パフォーマンス
- 素早いページロード
- スムーズなアニメーション
- 即座のレスポンス

### その他のAPIインターフェース

#### キャンセル理由取得
```
GET /api/v1/cancellation/reasons
```
**レスポンス:**
```json
{
  "reasons": [
    {
      "id": "change_of_plans",
      "label": "予定が変わった",
      "category": "user"
    },
    {
      "id": "found_better_option",
      "label": "より良い選択肢を見つけた",
      "category": "user"
    },
    {
      "id": "emergency",
      "label": "緊急事態",
      "category": "emergency"
    },
    {
      "id": "other",
      "label": "その他の理由",
      "category": "other",
      "requires_comment": true
    }
  ]
}
```

#### キャンセルフィードバック送信
```
POST /api/v1/cancellation/feedback
```
**リクエスト:**
```json
{
  "reservation_id": "res_123456",
  "reason_id": "change_of_plans",
  "comment": "会議時間が変更になりました",
  "rating": 4
}
```
**レスポンス:**
```json
{
  "success": true,
  "feedback_id": "fb_789",
  "coupon_awarded": {
    "coupon_id": "coup_abc",
    "discount_percentage": 10,
    "valid_until": "2024-03-15"
  }
}
```

#### 代替案取得
```
GET /api/v1/reservations/alternatives
```
**クエリパラメータ:**
- `original_reservation_id`: "res_123456"
- `latitude`: 35.6762
- `longitude`: 139.6503

**レスポンス:**
```json
{
  "alternatives": [
    {
      "station_id": 2,
      "station_name": "南山充電ステーション",
      "distance": 850,
      "available_slots": [
        {
          "start_time": "2024-02-15T20:00:00Z",
          "end_time": "2024-02-15T21:00:00Z",
          "type": "hold"
        }
      ]
    }
  ]
}
```